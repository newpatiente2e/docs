"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[525],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>h});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(r),h=a,m=u["".concat(s,".").concat(h)]||u[h]||d[h]||o;return r?n.createElement(m,i(i({ref:t},c),{},{components:r})):n.createElement(m,i({ref:t},c))}));function h(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}u.displayName="MDXCreateElement"},8894:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=r(7462),a=(r(7294),r(3905));const o={},i="Add surgery roles",l={unversionedId:"surgery-roles/add-roles",id:"surgery-roles/add-roles",title:"Add surgery roles",description:"Create Static Web App roles",source:"@site/docs/40-surgery-roles/20-add-roles.md",sourceDirName:"40-surgery-roles",slug:"/surgery-roles/add-roles",permalink:"/docs/surgery-roles/add-roles",draft:!1,editUrl:"https://github.com/newpatiente2e/docs/tree/main/docs/40-surgery-roles/20-add-roles.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Static Web App roles",permalink:"/docs/surgery-roles/static-web-app-roles"},next:{title:"Clean up",permalink:"/docs/clean-up"}},s={},p=[{value:"Create Static Web App roles",id:"create-static-web-app-roles",level:2},{value:"Securing web app routes with roles",id:"securing-web-app-routes-with-roles",level:2},{value:"Enable role-based access control",id:"enable-role-based-access-control",level:2},{value:"Redeploy Static Web App",id:"redeploy-static-web-app",level:2},{value:"Sign in to the surgery app",id:"sign-in-to-the-surgery-app",level:2},{value:"Update your roles",id:"update-your-roles",level:2}],c={toc:p};function d(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"add-surgery-roles"},"Add surgery roles"),(0,a.kt)("h2",{id:"create-static-web-app-roles"},"Create Static Web App roles"),(0,a.kt)("h2",{id:"securing-web-app-routes-with-roles"},"Securing web app routes with roles"),(0,a.kt)("p",null,"Access to the patient registration app is controlled by the roles and Static Web App routes are secured by the roles."),(0,a.kt)("p",null,"The patient registration app has several routes that are only accessible to users with specific roles, all under the ",(0,a.kt)("inlineCode",{parentName:"p"},"/surgery")," path. For example, the ",(0,a.kt)("inlineCode",{parentName:"p"},"/surgery/admin")," route is only accessible to users with the ",(0,a.kt)("inlineCode",{parentName:"p"},"admin")," role. The ",(0,a.kt)("inlineCode",{parentName:"p"},"/surgery/admin")," route is used to add new patient registrations in the app. The ",(0,a.kt)("inlineCode",{parentName:"p"},"/surgery/admin")," route is only accessible to users with the ",(0,a.kt)("inlineCode",{parentName:"p"},"admin")," role."),(0,a.kt)("h2",{id:"enable-role-based-access-control"},"Enable role-based access control"),(0,a.kt)("p",null,"Static Web Apps uses a JSON config file to enforce role-based access control (RBAC) on routes. The ",(0,a.kt)("inlineCode",{parentName:"p"},"staticwebapp.config.json")," file is located in the root of the application, in the ",(0,a.kt)("inlineCode",{parentName:"p"},"src/web")," folder. With this file, you can specify which roles are allowed to access specific routes, both for the web front end and the API."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Access control rules are applied in the a top-down fashion. The first matching rule is applied, and the rest are ignored, so the order of the rules matters.")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Open ",(0,a.kt)("inlineCode",{parentName:"p"},"staticwebapp.config.json")," in the ",(0,a.kt)("inlineCode",{parentName:"p"},"src/web")," folder.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Locate the ",(0,a.kt)("inlineCode",{parentName:"p"},"routes")," section and add the surgery admin route restriction."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "navigationFallback": {\n    "rewrite": "/index.html"\n  },\n  "routes": [\n    // highlight-start\n    {\n      "route": "/surgery/admin",\n      "allowedRoles": ["admin"]\n    }\n    // highlight-end\n  ],\n  "platform": {\n    "apiRuntime": "dotnet:6.0"\n  }\n}\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Repeat this process for the ",(0,a.kt)("inlineCode",{parentName:"p"},"/surgery/nurse")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"/surgery/doctor")," routes."))),(0,a.kt)("p",null,"We can also add access control to the API routes, located in the ",(0,a.kt)("inlineCode",{parentName:"p"},"/api")," path, and there are some routes that are only accessible by people who are authenticated, be they in the ",(0,a.kt)("inlineCode",{parentName:"p"},"admin"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"nurse"),", or ",(0,a.kt)("inlineCode",{parentName:"p"},"doctor")," roles. These routes all start with the prefix ",(0,a.kt)("inlineCode",{parentName:"p"},"/api/patient")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"/api/surgery"),". To apply access rules to multiple routes, you can use a wildcard character ",(0,a.kt)("inlineCode",{parentName:"p"},"*")," in the route path."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "navigationFallback": {\n    "rewrite": "/index.html"\n  },\n  "routes": [\n    {\n      "route": "/surgery/admin",\n      "allowedRoles": ["admin"]\n    },\n    {\n      "route": "/surgery/doctor",\n      "allowedRoles": ["doctor"]\n    },\n    {\n      "route": "/surgery/nurse",\n      "allowedRoles": ["nurse"]\n    },\n    {\n      "route": "/surgery/*",\n      "allowedRoles": ["authenticated"]\n    },\n    {\n      "route": "/api/new-patient/*",\n      "allowedRoles": ["anonymous"]\n    },\n    // highlight-start\n    {\n      "route": "/api/patient/*",\n      "allowedRoles": ["authenticated"]\n    },\n    {\n      "route": "/api/surgery/*",\n      "allowedRoles": ["authenticated"]\n    }\n    // highlight-end\n  ],\n  "platform": {\n    "apiRuntime": "dotnet:6.0"\n  }\n}\n')),(0,a.kt)("h2",{id:"redeploy-static-web-app"},"Redeploy Static Web App"),(0,a.kt)("p",null,"Redeploy the app to Azure Static Web Apps with the Azure Developer CLI."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"From VS Code, select ",(0,a.kt)("inlineCode",{parentName:"p"},"Ctrl+Shift+~")," to open a new terminal.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"From the terminal, run the following command to start the function app. This command will deploy the updated function to Azure."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"azd deploy --service web\n")))),(0,a.kt)("h2",{id:"sign-in-to-the-surgery-app"},"Sign in to the surgery app"),(0,a.kt)("p",null,"Sign in to the patient registration app."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"From the patient registration app, select ",(0,a.kt)("strong",{parentName:"li"},"Sign in"),", and then select the ",(0,a.kt)("strong",{parentName:"li"},"GitHub")," login provider."),(0,a.kt)("li",{parentName:"ol"},"If you added the ",(0,a.kt)("strong",{parentName:"li"},"admin")," role to the invitation, then you can add new patient registrations from the ",(0,a.kt)("strong",{parentName:"li"},"Admin")," tab.")),(0,a.kt)("h2",{id:"update-your-roles"},"Update your roles"),(0,a.kt)("p",null,"Next, you will update your roles in the Azure portal so that you have either the ",(0,a.kt)("strong",{parentName:"p"},"nurse")," or ",(0,a.kt)("strong",{parentName:"p"},"doctor")," role."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"From the Azure portal, select the Static Web App resource, from the left-hand menu, select ",(0,a.kt)("strong",{parentName:"li"},"Role management")),(0,a.kt)("li",{parentName:"ol"},"Select the user you want to update, and then update the role to either ",(0,a.kt)("strong",{parentName:"li"},"nurse")," or ",(0,a.kt)("strong",{parentName:"li"},"doctor"),"."),(0,a.kt)("li",{parentName:"ol"},"Select ",(0,a.kt)("strong",{parentName:"li"},"Update"),"."),(0,a.kt)("li",{parentName:"ol"},"Switch back to the patient registration web app, and logout."),(0,a.kt)("li",{parentName:"ol"},"Log back in to the patient registration app."),(0,a.kt)("li",{parentName:"ol"},"You will now see that you have access to the ",(0,a.kt)("strong",{parentName:"li"},"Nurse")," or the ",(0,a.kt)("strong",{parentName:"li"},"Doctor")," tabs depending on the role you assigned. You can now view the registered patient details.")))}d.isMDXComponent=!0}}]);